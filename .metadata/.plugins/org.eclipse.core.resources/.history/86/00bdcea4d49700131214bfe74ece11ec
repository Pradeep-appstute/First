package com.example.testproject;

import java.io.IOException;
import java.io.InputStream;
import java.util.ArrayList;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;
import android.app.Activity;
import android.os.Bundle;
import android.util.Log;
import android.view.Menu;

public class MainActivity extends Activity {

ArrayList<Ticket> ticketList;
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_main);
		
		
		InputStream is;
		byte[] buffer = null;
		try {
			is = this.getApplicationContext().getAssets().open("tickets.json");
			int size = is.available();
			buffer = new byte[size];
			is.read(buffer);
			is.close();
		} catch (IOException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		}

		String bufferString = new String(buffer);
		Log.d("TAG", "bufferString="+bufferString);
		
        try {

		     
		    Log.d("TAG", "1>>>>>>>>>>>>>>>");
		  //convert string to JSONArray
		    JSONArray jsonArray = new JSONArray(bufferString);
		    //parse an Object from a random index in the JSONArray
		     
		    //you can continue to set the different attributes of the Book object using key/value pairs from the Book class (e.g. setPageNum, setChapter, etc).
		    
		    Log.d("TAG", "2>>>>>>>>>>>>>>>");
		    // Getting JSON Array node
		    // looping through All Contacts
		    Log.d("TAG", "jsonArray.length()="+jsonArray.length());
		    for (int i = 0; i < jsonArray.length(); i++) {
		    	Ticket ticket = new Ticket();
		    	Log.d("TAG", i+">>>>>>>>>>>>>>>");
		    	JSONObject c = jsonArray.getJSONObject(i);
		    	Log.d("tag", ""+c.get("ticketId"));
		    	Log.d("tag", ""+c.get("subject"));
		    	Log.d("tag", ""+c.get("status"));
		    	Log.d("tag", ""+c.get("createDate"));
		    	Log.d("tag", ""+c.get("closeDate"));
		    	
		        // Phone node is JSON Object
		    	if(!(c.get("ticketId").equals(JSONObject.NULL)))
		    		ticket.ticketId=c.getInt("ticketId");
		    	else
		    		ticket.ticketId=-1;
		    	
		    	if(!(c.get("subject").equals(JSONObject.NULL)))
		    		ticket.subject=(String) c.get("subject");
		    	else
		    		ticket.subject="";
		    	
		    	if( !(c.get("status").equals(JSONObject.NULL)))
		    		ticket.status=(String) c.get("status");
		    	else
		    		ticket.status="";
		    	
		    	if(!(c.get("createDate").equals(JSONObject.NULL)))
		    		ticket.createDate=Integer.parseInt((String) c.get("createDate"));
		    	else
		    		ticket.createDate=-1;
		    	
		    	if( !(c.get("closeDate").equals(JSONObject.NULL)))
		    		ticket.closeDate=Integer.parseInt((String) c.get("closeDate"));
		    	else
		    		ticket.closeDate=-1;
		        // adding each child node to HashMap key => value


		        // adding contact to contact list
		        if (ticket!=null)
		        ticketList.add(ticket);
		    }
		} catch (JSONException e) {
		    e.printStackTrace();
		}
        
        Log.d("TAG", "Size="+ticketList.size());
	}

	@Override
	public boolean onCreateOptionsMenu(Menu menu) {
		// Inflate the menu; this adds items to the action bar if it is present.
		getMenuInflater().inflate(R.menu.main, menu);
		return true;
	}

}
